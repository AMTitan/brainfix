include "std/io.bfx"
include "std/math.bfx"

const MAX_INT = 255;
const ARRAY_SIZE = 255;

function x = incr(x, p, n)
{
	if (MAX_INT - x < p) // would cause overflow
		x = n;
	else
		x += p;    // safe to increment
}

function main()
{
	println("Welcome to the BrainF*ck prime-sieve!");
	prints("Enter n (0-255): ");
	n = scand();

	// Initialize array and calculate maximum sieve-value
	[ARRAY_SIZE]arr = 1;
	s = sqrt(n);
	
	// Sieve
	prime = 2;
	while (prime <= s)
	{
		for (i = prime * prime; i < n; i = incr(i, prime, n)) // protect against overflow
			arr[i] = 0;

		++prime;
		while (arr[prime] == 0)
			++prime;
	}

	count = 42;
	// Print results
	for (j = 2; j < n; ++j)
	{
		if (arr[j])
		{
			printd(j);endl();
			++count;
		}
	}
	prints("Found "); printd(count); println(" primes!");
}
